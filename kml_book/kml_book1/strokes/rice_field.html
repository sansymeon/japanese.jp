<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Different Strokes ‚Äì Rice Field</title>

  <!-- Load Yomogi BEFORE CSS so it's available -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Yomogi&display=swap" rel="stylesheet">

  <!-- Your stylesheet -->
  <link rel="stylesheet" href="../../kml_book1/styles/strokes.css" />

  <style>
    /* Closing Screen Override */
    #closing {
      position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
      text-align: center; opacity: 0; transition: opacity 1.5s ease; z-index: 10;
    }
    #closing.visible { opacity: 1; }
    .closing-art { max-width: 220px; margin: 0 auto 1rem; display: block; filter: grayscale(100%) contrast(120%); }
    .closing-buttons button {
      background: #fffaf0; border: 2px solid #333; border-radius: 8px;
      padding: 0.5rem 1.2rem; margin: 0.5rem; font-family: 'Yomogi', cursive;
      font-size: 1rem; cursor: pointer; transition: background 0.3s;
    }
    .closing-buttons button:hover { background: #e5e5e5; }

    /* ===== Emoji Block at Top ===== */
    .emoji-block {
      position: absolute; top: 8%; left: 50%; transform: translateX(-50%);
      text-align: center; opacity: 0; transition: opacity 1.5s ease-in-out;
      z-index: 3; max-width: 90%;
    }
    .emoji-block.visible { opacity: 1; }
    .emoji-icon { width: 70px; height: auto; display: block; margin: 0 auto 0.6rem; }
    .emoji-keyword { font-family: 'Yomogi', cursive; font-size: 1.6rem; color: #ff5722; font-weight: bold; margin-bottom: 0.8rem; }
    .emoji-block .attribution { font-size: 1rem; font-family: var(--font-main); color: #444; margin-bottom: 0.8rem; }
    .emoji-block .signature { font-size: 1rem; font-family: 'Yomogi', cursive; color: #222; }

    /* ===== Story Block (inline safety) ===== */
    .final-story {
      position: absolute; top: 35%; left: 50%; transform: translateX(-50%);
      max-width: 600px; font-size: 1.1rem; line-height: 1.6; color: #222;
      text-align: center; font-family: var(--font-main); opacity: 0;
      transition: opacity 1s ease-in-out; z-index: 4;
    }
    .final-story.visible { opacity: 1; }

    @media (max-width: 480px) {
      .emoji-keyword { font-size: 1.3rem; }
      .emoji-block .attribution { font-size: 0.9rem; }
      .emoji-block .signature { font-size: 1rem; }
      .emoji-icon { width: 55px; }
      .final-story { max-width: 85vw; font-size: 1rem; top: 34%; }
    }
  </style>
</head>
<body>

  <!-- Washi Background -->
  <div id="washi-bg"></div>
  <div id="washi-messy"></div>

  <!-- Intro -->
  <div id="intro" class="intro">
    <p><strong>Welcome to Different Strokes:<br>
    A unique way of learning Kanji stroke orders</strong></p>
    <p>While watching, trace the character on your palm.</p>
    <p><em>Introducing Áî∞ ‚Äì (ta) ‚Äúrice field‚Äù</em></p>
  </div>

  <div class="page">
    <!-- Kanji Stroke Layers -->
    <img id="color1" class="fade-in" src="images/rice_field/color1.png" alt="Stroke 1 Color" />
    <img id="black1" class="fade-in" src="images/rice_field/black1.png" alt="Stroke 1 Black" />

    <img id="color2" class="fade-in" src="images/rice_field/color2.png" alt="Stroke 2 Color" />
    <img id="black2" class="fade-in" src="images/rice_field/black2.png" alt="Stroke 2 Black" />

    <img id="color3" class="fade-in" src="images/rice_field/color3.png" alt="Stroke 3 Color" />
    <img id="black3" class="fade-in" src="images/rice_field/black3.png" alt="Stroke 3 Black" />

    <img id="color4" class="fade-in" src="images/rice_field/color4.png" alt="Stroke 4 Color" />
    <img id="black4" class="fade-in" src="images/rice_field/black4.png" alt="Stroke 4 Black" />

    <img id="color5" class="fade-in" src="images/rice_field/color5.png" alt="Stroke 5 Color" />
    <img id="black5" class="fade-in" src="images/rice_field/black5.png" alt="Stroke 5 Black" />

    <img id="color-final" class="fade-in" src="images/rice_field/color_final.png" alt="Full Kanji Color" />
    <img id="black" class="fade-in" src="images/rice_field/black_final.png" alt="Final Black Clear Form" />
    <img id="stamp" src="../images/stamp.png" alt="Inkan Stamp" />

    <!-- Story Block -->
    <div id="final-story" class="final-story">
      Four plots enclosed ‚Äî <br />
      a rice field seen from above. 
    </div>

    <!-- Top Emoji Block -->
    <div id="emoji-block" class="emoji-block">
      <img src="images/rice_field/emoji.png" alt="Emoji" class="emoji-icon" />
      <div class="emoji-keyword">Rice Field</div>
      <div class="attribution">Brought to you by SanSymeon &amp; ChatGPT</div>
      <div class="signature">Drawn by One. Remembered by Many.</div>
    </div>
  </div>

<!-- Closing Art + Buttons -->
<div id="closing" class="closing">
  <img src="../images/castle.png" alt="" class="closing-art" />
  <div class="closing-buttons">
    <button onclick="location.reload()">üîÅ Repeat</button>
    <a href="../index.html"><button class="study-btn">üìñ Study Kanji</button></a>
      <a href="../chapter_two/index.html"><button>‚û°Ô∏è Next</button></a>
  </div>
</div>


  <!-- Audio -->
  <audio id="bell-short" src="../sound/bell-short.mp3"></audio>
  <audio id="bell-long" src="../sound/bell-long.mp3"></audio>

  <!-- JS -->
  <script>
    const delay = (ms) => new Promise(res => setTimeout(res, ms));

    /* define the timing constants you used */
    const STORY_HOLD = 3200; // how long the story stays visible
    const STORY_FADE = 1200; // fade duration (matches CSS-ish)

    async function fadeSequence() {
      // ====== Intro ======
      const intro = document.getElementById('intro');
      intro?.classList.add('visible');
      await delay(3500);
      intro?.classList.add('fade-out');
      await delay(1200);

      // ====== Stroke loop ======
      let i = 1;
      while (true) {
        const color = document.getElementById(`color${i}`);
        const black = document.getElementById(`black${i}`);
        if (!color) break;

        color.classList.add('visible');
        document.getElementById('bell-short')?.play();
        await delay(1500);

        if (black) {
          black.classList.add('visible');
          await delay(500);
        }
        i++;
      }

      // ====== Final color pulse ======
      const finalColor = document.getElementById('color-final');
      if (finalColor) {
        finalColor.classList.add('visible');
        await delay(2000);
      }

      // ====== Final black ======
      const finalBlack = document.getElementById('black');
      if (finalBlack) {
        finalBlack.classList.add('visible');
        document.getElementById('bell-long')?.play();
        await delay(1000);
      }

      const stamp = document.getElementById('stamp');
      if (stamp) {
        stamp.classList.add('visible');
        await delay(1500);
      }

      // ====== Fade-out strokes ======
      for (let j = 1; j < i; j++) {
        document.getElementById(`color${j}`)?.classList.add('fade-out');
        document.getElementById(`black${j}`)?.classList.add('fade-out');
      }
      finalColor?.classList.add('fade-out');
      finalBlack?.classList.add('fade-out');
      await delay(2000);

      // ====== Story ======
      document.getElementById('final-story')?.classList.add('visible');
      await delay(STORY_HOLD);

      // ====== Fade story + stamp ======
      ['final-story','stamp'].forEach(id =>
        document.getElementById(id)?.classList.add('fade-out')
      );
      await delay(STORY_FADE);

      // ====== Emoji Block ======
      document.getElementById('emoji-block')?.classList.add('visible');
      await delay(3500);

      // ====== Fade everything ======
      ['emoji-block','washi-messy','final-word'].forEach(
        id => document.getElementById(id)?.classList.add('fade-out')
      );

      // ====== Closing screen ======
      await delay(1800);
      document.getElementById('closing')?.classList.add('visible');
    }

    window.onload = fadeSequence;
  </script>

</body>
</html>
